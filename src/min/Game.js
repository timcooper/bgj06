/*! rainbows 27-10-2013 */
var Main=Main||{};Main.Game=function(a){this.game=a},Main.Game.prototype={LEVELS:{1:{y:80},2:{y:208},3:{y:336}},COLORS:{red:{particle:"particleRed",gate:"gateRed"},yellow:{particle:"particleYellow",gate:"gateYellow"},blue:{particle:"particleBlue",gate:"gateBlue"},orange:{particle:"particleOrange",gate:"gateOrange"},green:{particle:"particleGreen",gate:"gateGreen"},purple:{particle:"particlePurple",gate:"gatePurple"},white:{particle:"particleWhite"},black:{particle:"particle"}},player:Phaser.Sprite,enabledColors:["red"],redKey:null,yellowKey:null,blueKey:null,bg:null,barriers:[],gates:[],maxVelocity:0,preload:function(){},create:function(){this.game.world.setBounds(0,0,12800,this.game.height),this.bg=this.game.add.tileSprite(0,0,this.game.width,this.game.height,"background"),this.bg.fixedToCamera=!0,this.player=this.game.add.sprite(0,50,"particle"),this.player.anchor.setTo(.5,.5),this.player.body.acceleration.x=50,this.game.camera.follow(this.player),Math.max(this.game.width,this.game.height)/8,this.game.camera.deadzone=new Phaser.Rectangle(0,0,200,this.game.height),this.redKey=this.game.input.keyboard.addKey(Phaser.Keyboard.ONE),this.yellowKey=this.game.input.keyboard.addKey(Phaser.Keyboard.TWO),this.blueKey=this.game.input.keyboard.addKey(Phaser.Keyboard.THREE),this.barriers=this.game.add.group(),this.barriers.createMultiple(30,"barrier1"),this.barriers.setAll("anchor.x",.5),this.barriers.setAll("outOfBoundsKill",!0),this.generateLevel(),this.player.bringToTop()},update:function(){this.game.time.elapsed,this.bg.tilePosition.x=-this.game.camera.x,this.bg.tilePosition.y=-this.game.camera.y,this.setVerticalLevel(),this.game.physics.collide(this.barriers,this.player,this.hitWall,null,this),this.colorBlack(),this.redKey.isDown&&this.colorRed(),this.yellowKey.isDown&&this.colorYellow(),this.blueKey.isDown&&this.colorBlue(),this.atEnd()&&(alert("Max velocity: "+this.maxVelocity),this.game.state.start("game")),this.writeDebug()},atEnd:function(){return this.player.x>=this.game.world.width},hitWall:function(a,b){"barrier1"==b.key&&this.player.center.y<144||"barrier2"==b.key&&this.player.center.y<272&&this.player.center.x>144||"barrier3"==b.key&&this.player.center.y>272?(console.log("yay"),this.player.body.acceleration.x=50):(this.player.body.velocity.x=0,this.player.body.acceleration.x=0)},colorBlack:function(){this.player.loadTexture(this.COLORS.black.particle,0)},colorRed:function(){this.yellowKey.isDown&&this.blueKey.isDown&&this.canChange("white")?this.player.loadTexture(this.COLORS.white.particle,0):this.yellowKey.isDown&&this.canChange("orange")?this.player.loadTexture(this.COLORS.orange.particle,0):this.blueKey.isDown&&this.canChange("purple")?this.player.loadTexture(this.COLORS.purple.particle,0):this.player.loadTexture(this.COLORS.red.particle,0)},colorYellow:function(){this.redKey.isDown&&this.blueKey.isDown&&this.canChange("white")?this.player.loadTexture(this.COLORS.white.particle,0):this.redKey.isDown&&this.canChange("orange")?this.player.loadTexture(this.COLORS.orange.particle,0):this.blueKey.isDown&&this.canChange("green")?this.player.loadTexture(this.COLORS.green.particle,0):this.canChange("yellow")&&this.player.loadTexture(this.COLORS.yellow.particle,0)},colorBlue:function(){this.yellowKey.isDown&&this.redKey.isDown&&this.canChange("white")?this.player.loadTexture(this.COLORS.white.particle,0):this.yellowKey.isDown&&this.canChange("green")?this.player.loadTexture(this.COLORS.green.particle,0):this.redKey.isDown&&this.canChange("purple")?this.player.loadTexture(this.COLORS.purple.particle,0):this.canChange("blue")&&this.player.loadTexture(this.COLORS.blue.particle,0)},setVerticalLevel:function(){var a=this.game.input.activePointer.y;144>a?this.player.centerOn(this.player.center.x,this.LEVELS[1].y):272>a?this.player.centerOn(this.player.center.x,this.LEVELS[2].y):this.player.centerOn(this.player.center.x,this.LEVELS[3].y)},generateLevel:function(){for(var a=null,b=0;b<this.barriers.length;b++){var c=this.game.rnd.integerInRange(1,4),d=(this.COLORS[this.enabledColors[this.game.rnd.integerInRange(1,this.enabledColors.length)-1]],512*(b+1));console.log(c),a=this.barriers.getFirstDead(),a.body.customSeparateX=!0,a.body.customSeparateY=!0,c>1&&a.loadTexture("barrier"+c,0),a.reset(d,0),a.body.immovable=!0,console.log("color = "+this.randomColor())}},canChange:function(a){return-1!==this.enabledColors.indexOf(a)},randomColor:function(){var a,b=0;for(var c in this.COLORS)this.canChange(c)&&Math.random()<1/++b&&(a=c);return a},writeDebug:function(){var a=window.document.getElementById("debug-velocity"),b=Math.round(this.player.body.velocity.x),c=window.document.getElementById("debug-dist");b>this.maxVelocity&&(this.maxVelocity=b),a.innerHTML=b,c.innerHTML=Math.round(this.player.center.x+this.game.camera.x)}};